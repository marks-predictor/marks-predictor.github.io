<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WBJEE GMR Predictor</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <h1>ðŸ“Š WBJEE GMR Predictor</h1>
    <p>Enter your total marks (out of 200):</p>
    <input type="number" id="marks" placeholder="e.g., 123" />
    <button onclick="predictGMR()">Predict GMR</button>
    <div id="output"></div>
  </div>

  <script>
    function median(arr) {
      const sorted = [...arr].sort((a, b) => a - b);
      const mid = Math.floor(sorted.length / 2);
      return sorted.length % 2 === 0
        ? (sorted[mid - 1] + sorted[mid]) / 2
        : sorted[mid];
    }

    async function predictGMR() {
      const marks = parseFloat(document.getElementById('marks').value);
      const output = document.getElementById('output');
      output.innerHTML = '';

      if (isNaN(marks) || marks < 0 || marks > 200) {
        output.innerHTML = '<p style="color: red;">Enter valid marks between 0 and 200.</p>';
        return;
      }

      const res = await fetch('data/gmr_data.json');
      const data = await res.json();

      const years = ['2022', '2023', '2024'];
      const allPoints = years.flatMap(year => data[year]);
      const nearbyMatches = allPoints.filter(p => Math.abs(p.marks - marks) <= 10);

      // AI-like Prediction
      const gmrs = nearbyMatches.map(p => p.gmr);
      const aiMin = Math.min(...gmrs);
      const aiMax = Math.max(...gmrs);
      const aiMedian = Math.round(median(gmrs));

      output.innerHTML += `<h2>ðŸ”® AI Estimated GMR for 2025</h2>`;
      output.innerHTML += `
        <ul>
          <li><strong>Estimated GMR:</strong> ${aiMin} â€“ ${aiMax}</li>
          <li><strong>AI Median Estimate:</strong> ~ ${aiMedian}</li>
          <li>Based on real pattern from 2022â€“2024 (Â±10 marks)</li>
        </ul>`;

      // Real Data for Each Year
      output.innerHTML += `<h2>ðŸ“Š Matching Data (Â±10 Marks) Per Year</h2>`;

      years.forEach(year => {
        const matches = data[year]
          .filter(p => Math.abs(p.marks - marks) <= 10)
          .sort((a, b) => a.marks - b.marks);

        if (matches.length > 0) {
          const gmrMin = Math.min(...matches.map(m => m.gmr));
          const gmrMax = Math.max(...matches.map(m => m.gmr));
          output.innerHTML += `<div class="year-block"><h3>ðŸ”¹ ${year} (GMR Range: ${gmrMin} â€“ ${gmrMax})</h3><ul>`;
          matches.forEach(match => {
            const diff = marks - match.marks;
            let status = '';
            if (diff > 2) {
              status = `ðŸŸ¢ Higher than ${match.marks} marks (GMR ${match.gmr})`;
            } else if (diff < -2) {
              status = `ðŸ”´ Lower than ${match.marks} marks (GMR ${match.gmr})`;
            } else {
              status = `ðŸŸ¡ Very close to ${match.marks} marks (GMR ${match.gmr})`;
            }
            output.innerHTML += `
              <li>
                <strong>Marks:</strong> ${match.marks} â†’ <strong>GMR:</strong> ${match.gmr}<br/>
                <span class="status">${status}</span>
              </li>`;
          });
          output.innerHTML += `</ul></div>`;
        } else {
          output.innerHTML += `<div class="year-block"><h3>ðŸ”¹ ${year}</h3><p>No data found within Â±10 marks of ${marks}</p></div>`;
        }
      });
    }
  </script>
</body>
</html>
