<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WBJEE GMR Predictor</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <h1>ðŸ“Š WBJEE GMR Predictor</h1>
    <p>Enter your total marks (out of 200):</p>
    <input type="number" id="marks" placeholder="e.g., 123" />
    <button onclick="predictGMR()">Predict GMR</button>
    <div id="output"></div>
  </div>

  <script>
    async function predictGMR() {
      const marks = parseFloat(document.getElementById('marks').value);
      const output = document.getElementById('output');
      output.innerHTML = '';

      if (isNaN(marks) || marks < 0 || marks > 200) {
        output.innerHTML = '<p style="color: red;">Enter valid marks between 0 and 200.</p>';
        return;
      }

      const res = await fetch('data/gmr_data.json');
      const data = await res.json();

      const years = ['2022', '2023', '2024'];
      const allPoints = years.flatMap(year => data[year]);
      allPoints.sort((a, b) => a.marks - b.marks);

      let lower = null, upper = null;
      for (let i = 0; i < allPoints.length; i++) {
        if (allPoints[i].marks <= marks) lower = allPoints[i];
        if (allPoints[i].marks >= marks) {
          upper = allPoints[i];
          break;
        }
      }

      let estimatedMin = null, estimatedMax = null;
      if (lower && upper && lower.marks !== upper.marks) {
        const slope = (upper.gmr - lower.gmr) / (upper.marks - lower.marks);
        const est = lower.gmr + slope * (marks - lower.marks);
        const buffer = Math.max(10, Math.abs(upper.gmr - lower.gmr) * 0.15);
        estimatedMin = Math.max(1, Math.round(est - buffer));
        estimatedMax = Math.round(est + buffer);
      } else if (lower) {
        const buffer = Math.max(30, lower.gmr * 0.08);
        estimatedMin = Math.max(1, Math.round(lower.gmr - buffer));
        estimatedMax = Math.round(lower.gmr + buffer);
      } else if (upper) {
        const buffer = Math.max(30, upper.gmr * 0.08);
        estimatedMin = Math.max(1, Math.round(upper.gmr - buffer));
        estimatedMax = Math.round(upper.gmr + buffer);
      }

      // ðŸ”® AI Prediction for 2025
      output.innerHTML += `<h2>ðŸ”® AI Estimated GMR for 2025</h2>`;
      output.innerHTML += `
        <ul>
          <li><strong>Estimated GMR:</strong> ${estimatedMin} â€“ ${estimatedMax}</li>
          <li>Based on patterns from 2022, 2023, and 2024</li>
        </ul>`;

      // ðŸ“Š Actual Data from all years (Â±10 marks)
      output.innerHTML += `<h2>ðŸ“Š Matching Data (Â±10 Marks) Per Year</h2>`;
      years.forEach(year => {
        const matches = data[year]
          .filter(p => Math.abs(p.marks - marks) <= 10)
          .sort((a, b) => a.marks - b.marks);

        if (matches.length > 0) {
          const gmrMin = Math.min(...matches.map(m => m.gmr));
          const gmrMax = Math.max(...matches.map(m => m.gmr));

          output.innerHTML += `<div class="year-block"><h3>ðŸ”¹ ${year} (GMR Range: ${gmrMin} â€“ ${gmrMax})</h3><ul>`;
          matches.forEach(match => {
            const diff = marks - match.marks;
            let status = '';
            if (diff > 2) {
              status = `ðŸŸ¢ Higher than ${match.marks} marks (GMR ${match.gmr})`;
            } else if (diff < -2) {
              status = `ðŸ”´ Lower than ${match.marks} marks (GMR ${match.gmr})`;
            } else {
              status = `ðŸŸ¡ Very close to ${match.marks} marks (GMR ${match.gmr})`;
            }
            output.innerHTML += `
              <li>
                <strong>Marks:</strong> ${match.marks} â†’ <strong>GMR:</strong> ${match.gmr}<br/>
                <span class="status">${status}</span>
              </li>`;
          });
          output.innerHTML += `</ul></div>`;
        } else {
          output.innerHTML += `<div class="year-block"><h3>ðŸ”¹ ${year}</h3><p>No data found within Â±10 marks of ${marks}</p></div>`;
        }
      });
    }
  </script>
</body>
</html>
